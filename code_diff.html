<!DOCTYPE html>
<html lang="nl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Vergelijker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/github.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/diff/dist/diff.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { slate: { 850: '#1e293b', 950: '#020617' } } } }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 5px; }
        .d2h-wrapper { background-color: #0f172a; border: none; }
        .d2h-file-header { background-color: #1e293b !important; border-bottom: 1px solid #334155 !important; color: #e2e8f0 !important; }
        .d2h-file-wrapper { border: 1px solid #334155 !important; margin-bottom: 1em; background-color: #0f172a; }
        .d2h-code-line-ctn { color: #cbd5e1; }
        .d2h-info { background-color: #1e293b !important; color: #94a3b8 !important; border-color: #334155 !important; }
        .code-font { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; }

        /* FIX VOOR REGELNUMMERS: Maakt de regelnummers sticky bovenaan de tabel */
        .d2h-code-side-linenumber, .d2h-code-linenumber {
            position: sticky;
            top: 0; 
            z-index: 10;
        }
        
        /* Zorg dat de headers ook sticky zijn om het geheel kloppend te maken */
        .d2h-file-header {
            position: sticky;
            top: 0;
            z-index: 20;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans h-screen flex flex-col">

    <header class="h-14 bg-slate-800 border-b border-slate-700 flex items-center justify-between px-4 sticky top-0 z-50 shadow-md">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-400 hover:text-white flex items-center gap-1 text-sm font-medium transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                Home
            </a>
            <div class="h-6 w-px bg-slate-600 mx-2"></div>
            <h1 class="text-lg font-bold tracking-wide">Code <span class="text-purple-500">Vergelijker</span></h1>
        </div>
        <div id="result-controls" class="hidden flex items-center gap-2 text-xs sm:text-sm">
            <button onclick="toggleInput()" class="text-slate-400 hover:text-white mr-4 flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12" /></svg>
                Bewerk
            </button>
            <button onclick="setDiffMode('side-by-side')" id="btn-diff-side" class="px-3 py-1.5 rounded transition-colors bg-purple-600 text-white">Naast elkaar</button>
            <button onclick="setDiffMode('line-by-line')" id="btn-diff-line" class="px-3 py-1.5 rounded transition-colors text-slate-400 hover:bg-slate-700">Gecombineerd</button>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-6 w-full max-w-7xl mx-auto flex flex-col gap-6">
        
        <!-- INPUT VIEW -->
        <div id="section-input" class="flex flex-col h-full gap-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-[70vh]">
                <!-- Origineel Veld -->
                <div class="flex flex-col gap-2 h-full">
                    <div class="flex justify-between items-center px-1">
                        <label class="font-semibold text-red-400 text-sm flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-red-500"></span> Origineel</label>
                        <div class="relative">
                            <label class="cursor-pointer text-xs bg-slate-800 border border-slate-700 hover:bg-slate-700 text-slate-300 px-2 py-1 rounded transition">
                                ðŸ“‚ Upload
                                <input type="file" class="hidden" onchange="handleDiffUpload(this, 'diff-input-old')">
                            </label>
                        </div>
                    </div>
                    <textarea id="diff-input-old" oninput="updateLineCounts()" class="flex-grow w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-slate-300 code-font text-xs focus:outline-none focus:border-purple-500 resize-none" placeholder="Plak hier het originele bestand..."></textarea>
                    <!-- Regelteller -->
                    <span id="line-count-old" class="text-sm font-semibold text-center mt-1">Regels: 0</span>
                </div>
                
                <!-- Aangepast Veld -->
                <div class="flex flex-col gap-2 h-full">
                    <div class="flex justify-between items-center px-1">
                        <label class="font-semibold text-green-400 text-sm flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500"></span> Aangepast</label>
                        <div class="relative">
                            <label class="cursor-pointer text-xs bg-slate-800 border border-slate-700 hover:bg-slate-700 text-slate-300 px-2 py-1 rounded transition">
                                ðŸ“‚ Upload
                                <input type="file" class="hidden" onchange="handleDiffUpload(this, 'diff-input-new')">
                            </label>
                        </div>
                    </div>
                    <textarea id="diff-input-new" oninput="updateLineCounts()" class="flex-grow w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-slate-300 code-font text-xs focus:outline-none focus:border-purple-500 resize-none" placeholder="Plak hier het nieuwe bestand..."></textarea>
                    <!-- Regelteller -->
                    <span id="line-count-new" class="text-sm font-semibold text-center mt-1">Regels: 0</span>
                </div>
            </div>
            <div class="flex justify-center">
                <button onclick="generateDiff()" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 px-8 rounded shadow-lg transition transform hover:-translate-y-0.5 flex items-center gap-2 text-lg">
                    Vergelijk Code
                </button>
            </div>
        </div>

        <!-- RESULT VIEW -->
        <!-- Aangepast: h-full verwijderd, flex-1 toegevoegd voor juiste hoogteberekening -->
        <div id="section-result" class="hidden flex-col flex-1 overflow-y-auto pb-10">
            <div id="diff-result-area" class="rounded-lg overflow-hidden border border-slate-700 shadow-xl"></div>
        </div>

    </main>

    <script>
        let currentDiffMode = 'side-by-side';
        const oldInput = document.getElementById('diff-input-old');
        const newInput = document.getElementById('diff-input-new');
        const oldLineCount = document.getElementById('line-count-old');
        const newLineCount = document.getElementById('line-count-new');

        function handleDiffUpload(input, targetId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { 
                    document.getElementById(targetId).value = e.target.result;
                    updateLineCounts(); 
                };
                reader.readAsText(input.files[0]);
            }
        }

        function toggleInput() {
            document.getElementById('section-result').classList.add('hidden');
            document.getElementById('section-input').classList.remove('hidden');
            document.getElementById('result-controls').classList.add('hidden');
        }

        function generateDiff() {
            const oldText = oldInput.value;
            const newText = newInput.value;
            if (!oldText && !newText) { alert("Vul beide velden in."); return; }

            document.getElementById('section-input').classList.add('hidden');
            document.getElementById('section-result').classList.remove('hidden');
            document.getElementById('result-controls').classList.remove('hidden');
            document.getElementById('section-result').classList.add('flex');

            renderDiff(oldText, newText);
        }

        function renderDiff(oldText, newText) {
            const diffString = Diff.createTwoFilesPatch("Origineel", "Aangepast", oldText, newText);
            const targetElement = document.getElementById('diff-result-area');
            const configuration = { drawFileList: false, matching: 'lines', outputFormat: currentDiffMode, colorScheme: 'dark' };
            const diff2htmlUi = new Diff2HtmlUI(targetElement, diffString, configuration);
            
            // Render de diff
            diff2htmlUi.draw();
            diff2htmlUi.highlightCode();
            
            // Scroll naar boven na het renderen van de resultaten
            document.getElementById('section-result').scrollTo(0, 0);
        }

        function setDiffMode(mode) {
            currentDiffMode = mode;
            const btnSide = document.getElementById('btn-diff-side');
            const btnLine = document.getElementById('btn-diff-line');
            
            if (mode === 'side-by-side') {
                btnSide.className = 'px-3 py-1.5 rounded transition-colors bg-purple-600 text-white';
                btnLine.className = 'px-3 py-1.5 rounded transition-colors text-slate-400 hover:bg-slate-700';
            } else {
                btnLine.className = 'px-3 py-1.5 rounded transition-colors bg-purple-600 text-white';
                btnSide.className = 'px-3 py-1.5 rounded transition-colors text-slate-400 hover:bg-slate-700';
            }
            
            const oldText = oldInput.value;
            const newText = newInput.value;
            renderDiff(oldText, newText);
        }
        
        function updateLineCounts() {
            const oldLines = oldInput.value.split('\n').length;
            const newLines = newInput.value.split('\n').length;
            
            const updateSpan = (el, count, colorClass) => {
                el.textContent = `Regels: ${count}`;
                el.classList.remove('text-green-400', 'text-red-400', 'text-blue-400', 'text-slate-400');
                el.classList.add(colorClass);
            };

            if (oldLines > newLines) {
                updateSpan(oldLineCount, oldLines, 'text-green-400');
                updateSpan(newLineCount, newLines, 'text-red-400');
            } else if (newLines > oldLines) {
                updateSpan(oldLineCount, oldLines, 'text-red-400');
                updateSpan(newLineCount, newLines, 'text-green-400');
            } else if (oldLines > 0) {
                updateSpan(oldLineCount, oldLines, 'text-blue-400');
                updateSpan(newLineCount, newLines, 'text-blue-400');
            } else {
                updateSpan(oldLineCount, oldLines, 'text-slate-400');
                updateSpan(newLineCount, newLines, 'text-slate-400');
            }
        }
        
        document.addEventListener('DOMContentLoaded', updateLineCounts);
    </script>
</body>
</html>
